# üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

## –î–∞—Ç–∞: 2025-10-15

---

## üéØ –¢–µ–∫—É—â–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: –°–∫–æ–ª—å–∫–æ –≤—ã–¥–µ—Ä–∂–∏—Ç?

### –û—Ü–µ–Ω–∫–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏):

**–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
- **~50-100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä** (100-200 –∏–≥—Ä–æ–∫–æ–≤)
- **~500-1000 –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (–≤ –ª–æ–±–±–∏, –Ω–µ –∏–≥—Ä–∞—é—Ç)

**–ü–æ—á–µ–º—É —Ç–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?**

---

## üî• –£–∑–∫–∏–µ –º–µ—Å—Ç–∞ (Bottlenecks)

### 1. ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –§–∏–∑–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ (60 FPS –Ω–∞ –∏–≥—Ä—É!)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// controllers/Game.js:35
setInterval(this.update, 1000 / FPS);  // 60 FPS = –∫–∞–∂–¥—ã–µ 16.67ms!
```

**–ö–∞–∂–¥–∞—è –∏–≥—Ä–∞:**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–≤–æ–π `setInterval` —Å —á–∞—Å—Ç–æ—Ç–æ–π 60 FPS
- –í—ã–∑—ã–≤–∞–µ—Ç `_oPhysicsController.update(_aBalls)` 60 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è 16 —à–∞—Ä–æ–≤ –º–µ–∂–¥—É —Å–æ–±–æ–π (16√ó15/2 = 120 –ø—Ä–æ–≤–µ—Ä–æ–∫)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –±–æ—Ä—Ç–∞–º–∏ (6 –±–æ—Ä—Ç–æ–≤ √ó 16 —à–∞—Ä–æ–≤ = 96 –ø—Ä–æ–≤–µ—Ä–æ–∫)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –ª—É–∑—ã (6 –ª—É–∑ √ó 16 —à–∞—Ä–æ–≤ = 96 –ø—Ä–æ–≤–µ—Ä–æ–∫)

**–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU:**
- 1 –∏–≥—Ä–∞ = ~5-10% CPU (–æ–¥–Ω–æ —è–¥—Ä–æ)
- 10 –∏–≥—Ä = ~50-100% CPU (–æ–¥–Ω–æ —è–¥—Ä–æ)
- **100 –∏–≥—Ä = 500-1000% CPU (–Ω—É–∂–Ω–æ 5-10 —è–¥–µ—Ä!)**

**–†–∞—Å—á–µ—Ç:**
```
60 FPS √ó 100 –∏–≥—Ä = 6000 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ñ–∏–∑–∏–∫–∏ –≤ —Å–µ–∫—É–Ω–¥—É
6000 √ó (120 + 96 + 96) –ø—Ä–æ–≤–µ—Ä–æ–∫ = 1,872,000 –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫
```

### 2. ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –ü–∞–º—è—Ç—å (–∫–∞–∂–¥–∞—è –∏–≥—Ä–∞ = ~10-20 MB)

**–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã:**

```javascript
// controllers/Game.js
var _table;              // –û–±—ä–µ–∫—Ç —Å—Ç–æ–ª–∞
var _players = new Map(); // –ò–≥—Ä–æ–∫–∏
var _aBalls;             // 16 —à–∞—Ä–æ–≤ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏, —Å–∫–æ—Ä–æ—Å—Ç—è–º–∏, –≤—Ä–∞—â–µ–Ω–∏—è–º–∏

// controllers/PhysicsController.js
var _aFieldEdges;        // –ú–∞—Å—Å–∏–≤—ã –≥—Ä–∞–Ω–∏—Ü —Å—Ç–æ–ª–∞
var _aHoleEdges;         // –ú–∞—Å—Å–∏–≤—ã –ª—É–∑
var _aBalls;             // –ö–æ–ø–∏—è –º–∞—Å—Å–∏–≤–∞ —à–∞—Ä–æ–≤
```

**–†–∞—Å—á–µ—Ç –ø–∞–º—è—Ç–∏:**
- 1 –∏–≥—Ä–∞ ‚âà 10-20 MB
- 100 –∏–≥—Ä ‚âà 1-2 GB
- 1000 –∏–≥—Ä ‚âà 10-20 GB ‚ùå (—Å–µ—Ä–≤–µ—Ä —É–ø–∞–¥–µ—Ç!)

### 3. ‚ö†Ô∏è Socket.IO —Å–æ–±—ã—Ç–∏—è (—Å–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫)

**–ö–∞–∂–¥–∞—è –∏–≥—Ä–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
- `updateBalls` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —à–∞—Ä–æ–≤ (–∫–∞–∂–¥—ã–π –∫–∞–¥—Ä –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏)
- `changeTurn` - —Å–º–µ–Ω–∞ —Ö–æ–¥–∞
- `_onPressHitArea`, `_onPressMoveHitArea` - –¥–≤–∏–∂–µ–Ω–∏—è –∫–∏—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

**–ù–∞–≥—Ä—É–∑–∫–∞:**
- 1 –∏–≥—Ä–∞ –≤–æ –≤—Ä–µ–º—è —É–¥–∞—Ä–∞: ~60 —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫ √ó 2 –∫–ª–∏–µ–Ω—Ç–∞ = 120 —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫
- 100 –∏–≥—Ä: 12,000 —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫
- –ü—Ä–∏ 1 KB –Ω–∞ —Å–æ–±—ã—Ç–∏–µ: **12 MB/—Å–µ–∫ = 96 Mbps** –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞!

### 4. ‚ö†Ô∏è MongoDB –∑–∞–ø—Ä–æ—Å—ã

**–¢–µ–∫—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:**
```javascript
// server.js:126-133
app.get('/api/players', async (req, res) => {
  const players = await Player.find({ status: true });
});
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ `walletAddress`
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –≤ –ë–î

### 5. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—á–∏—Å—Ç–∫–∏ –ø–∞–º—è—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// controllers/gameSocket.js:124-129
if (room.getPlayerCount() == 0) {
  games.delete(id);  // ‚úÖ –£–¥–∞–ª—è–µ—Ç –∫–æ–º–Ω–∞—Ç—É
}
```

**–ù–û:**
```javascript
// controllers/Game.js:35
setInterval(this.update, 1000 / FPS);  // ‚ùå –ù–ï –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢–°–Ø!
```

**–£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏:**
- `setInterval` –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ `games.delete(id)`
- –ù—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `clearInterval()` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä—ã!

---

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –£—Ä–æ–≤–µ–Ω—å 1: –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –¥–Ω—è)

#### 1.1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// controllers/Game.js:35
setInterval(this.update, 1000 / FPS);  // –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ID!
```

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// controllers/Game.js
var _updateInterval;

this.init = function (roomid, data) {
  _updateInterval = setInterval(this.update, 1000 / FPS);
  // ...
};

this.destroy = function() {
  if (_updateInterval) {
    clearInterval(_updateInterval);
    _updateInterval = null;
  }
  _table = null;
  _players.clear();
};
```

**–í—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:**
```javascript
// controllers/gameSocket.js:124-129
if (room.getPlayerCount() == 0) {
  room.destroy();  // ‚úÖ –û—á–∏—â–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
  games.delete(id);
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£—Å—Ç—Ä–∞–Ω—è–µ—Ç —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏, +50% –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

#### 1.2. –°–Ω–∏–∂–µ–Ω–∏–µ FPS –¥–ª—è —Ñ–∏–∑–∏–∫–∏

**–¢–µ–∫—É—â–µ–µ:**
```javascript
module.exports.FPS = 60;  // 60 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π/—Å–µ–∫
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```javascript
module.exports.FPS = 30;  // 30 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π/—Å–µ–∫
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU –≤ 2 —Ä–∞–∑–∞
- –§–∏–∑–∏–∫–∞ –≤—Å–µ –µ—â–µ –ø–ª–∞–≤–Ω–∞—è (30 FPS –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±–∏–ª—å—è—Ä–¥–∞)
- **–ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –∏–≥—Ä!**

#### 1.3. –ò–Ω–¥–µ–∫—Å—ã MongoDB

```javascript
// models.js
const playerSchema = new mongoose.Schema({
  walletAddress: { 
    type: String, 
    required: true, 
    unique: true,
    index: true  // ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å
  },
  // ...
});
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 10-100 —Ä–∞–∑

#### 1.4. Rate limiting –¥–ª—è Socket.IO

**–£–∂–µ –µ—Å—Ç—å, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:**
```javascript
// controllers/gameSocket.js:5-25
const socketRateLimiter = new Map();

function checkSocketRateLimit(socket, event) {
  const key = `${socket.id}:${event}`;
  const now = Date.now();
  const limit = socketRateLimiter.get(key);
  
  if (limit && now - limit < 100) {  // –ú–∏–Ω–∏–º—É–º 100ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    return false;
  }
  
  socketRateLimiter.set(key, now);
  return true;
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞, —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 20-30%

---

### –£—Ä–æ–≤–µ–Ω—å 2: –°—Ä–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (1 –Ω–µ–¥–µ–ª—è)

#### 2.1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤

```javascript
const NodeCache = require('node-cache');
const playerCache = new NodeCache({ stdTTL: 600 }); // 10 –º–∏–Ω—É—Ç

app.get('/api/players', async (req, res) => {
  const cached = playerCache.get('all_players');
  if (cached) {
    return res.json(cached);
  }
  
  const players = await Player.find({ status: true });
  playerCache.set('all_players', players);
  res.json(players);
});
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ MongoDB –Ω–∞ 90%

#### 2.2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∏–∑–∏–∫–∏: Spatial Hashing

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –í–°–ï –ø–∞—Ä—ã —à–∞—Ä–æ–≤ (16√ó15/2 = 120 –ø—Ä–æ–≤–µ—Ä–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:**
–†–∞–∑–¥–µ–ª–∏—Ç—å —Å—Ç–æ–ª –Ω–∞ —Å–µ—Ç–∫—É, –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ –±–ª–∏–∑–∫–∏–µ —à–∞—Ä—ã

```javascript
// controllers/PhysicsController.js
this.update = function (aBalls) {
  // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—É—é —Å–µ—Ç–∫—É
  const grid = new Map();
  const cellSize = BALL_DIAMETER * 2;
  
  // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞—Ä—ã –ø–æ —è—á–µ–π–∫–∞–º
  for (let ball of aBalls) {
    const cellX = Math.floor(ball.getX() / cellSize);
    const cellY = Math.floor(ball.getY() / cellSize);
    const key = `${cellX},${cellY}`;
    
    if (!grid.has(key)) grid.set(key, []);
    grid.get(key).push(ball);
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —è—á–µ–µ–∫ –∏ —Å–æ—Å–µ–¥–Ω–∏—Ö
  // –í–º–µ—Å—Ç–æ 120 –ø—Ä–æ–≤–µ—Ä–æ–∫ -> ~20-30 –ø—Ä–æ–≤–µ—Ä–æ–∫!
};
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Ñ–∏–∑–∏–∫—É –Ω–∞ 60-70%

#### 2.3. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π FPS

```javascript
// controllers/Game.js
var _currentFPS = 60;
var _ballsMoving = false;

this.update = function() {
  _table.updatePhysics();
  
  const ballsStopped = _table.areBallsStopped();
  
  if (ballsStopped && _ballsMoving) {
    // –®–∞—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å - —Å–Ω–∏–∂–∞–µ–º FPS
    _ballsMoving = false;
    this.setFPS(10);  // 10 FPS –∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
  } else if (!ballsStopped && !_ballsMoving) {
    // –®–∞—Ä—ã –Ω–∞—á–∞–ª–∏ –¥–≤–∏–≥–∞—Ç—å—Å—è - –ø–æ–≤—ã—à–∞–µ–º FPS
    _ballsMoving = true;
    this.setFPS(60);  // 60 FPS –≤–æ –≤—Ä–µ–º—è –¥–≤–∏–∂–µ–Ω–∏—è
  }
};

this.setFPS = function(fps) {
  if (_currentFPS === fps) return;
  
  clearInterval(_updateInterval);
  _currentFPS = fps;
  _updateInterval = setInterval(this.update, 1000 / fps);
};
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- 90% –≤—Ä–µ–º–µ–Ω–∏ –∏–≥—Ä—ã —à–∞—Ä—ã –Ω–µ –¥–≤–∏–≥–∞—é—Ç—Å—è (10 FPS)
- 10% –≤—Ä–µ–º–µ–Ω–∏ —à–∞—Ä—ã –¥–≤–∏–≥–∞—é—Ç—Å—è (60 FPS)
- **–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç—Å—è –Ω–∞ 85%!**

---

### –£—Ä–æ–≤–µ–Ω—å 3: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (2-4 –Ω–µ–¥–µ–ª–∏)

#### 3.1. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Redis

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Server 1   ‚îÇ     ‚îÇ  Server 2   ‚îÇ     ‚îÇ  Server 3   ‚îÇ
‚îÇ  (50 –∏–≥—Ä)   ‚îÇ     ‚îÇ  (50 –∏–≥—Ä)   ‚îÇ     ‚îÇ  (50 –∏–≥—Ä)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                   ‚îÇ                   ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    Redis    ‚îÇ
                    ‚îÇ  (Pub/Sub)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
npm install redis socket.io-redis
```

**–ö–æ–¥:**
```javascript
// server.js
const redis = require('redis');
const redisAdapter = require('socket.io-redis');

const pubClient = redis.createClient({ host: 'localhost', port: 6379 });
const subClient = pubClient.duplicate();

io.adapter(redisAdapter({ pubClient, subClient }));
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- 1 —Å–µ—Ä–≤–µ—Ä = 50-100 –∏–≥—Ä
- 10 —Å–µ—Ä–≤–µ—Ä–æ–≤ = 500-1000 –∏–≥—Ä
- **–õ–∏–Ω–µ–π–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ!**

#### 3.2. Load Balancer (Nginx)

```nginx
# nginx.conf
upstream billiard_servers {
    least_conn;  # –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–∞–∏–º–µ–Ω—å—à–µ–π –Ω–∞–≥—Ä—É–∑–∫–µ
    server 127.0.0.1:2083;
    server 127.0.0.1:2084;
    server 127.0.0.1:2085;
}

server {
    listen 80;
    
    location / {
        proxy_pass http://billiard_servers;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

#### 3.3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)

```javascript
// server.js
const promClient = require('prom-client');

const activeGames = new promClient.Gauge({
  name: 'billiard_active_games',
  help: 'Number of active games'
});

const activePlayers = new promClient.Gauge({
  name: 'billiard_active_players',
  help: 'Number of active players'
});

// –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
setInterval(() => {
  activeGames.set(games.size);
  activePlayers.set(Array.from(games.values())
    .reduce((sum, game) => sum + game.getPlayerCount(), 0));
}, 10000);

app.get('/metrics', (req, res) => {
  res.set('Content-Type', promClient.register.contentType);
  res.end(promClient.register.metrics());
});
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –ò–≥—Ä—ã | –ò–≥—Ä–æ–∫–∏ | CPU | RAM | –°–µ—Ç—å |
|--------------|------|--------|-----|-----|------|
| **–¢–µ–∫—É—â–∞—è (–±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)** | 50 | 100 | 100% (1 —è–¥—Ä–æ) | 1 GB | 10 Mbps |
| **+ –£—Ä–æ–≤–µ–Ω—å 1 (–±—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)** | 100 | 200 | 100% (2 —è–¥—Ä–∞) | 1.5 GB | 15 Mbps |
| **+ –£—Ä–æ–≤–µ–Ω—å 2 (—Å—Ä–µ–¥–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)** | 300 | 600 | 100% (4 —è–¥—Ä–∞) | 3 GB | 30 Mbps |
| **+ –£—Ä–æ–≤–µ–Ω—å 3 (–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)** | 1000+ | 2000+ | –õ–∏–Ω–µ–π–Ω–æ | –õ–∏–Ω–µ–π–Ω–æ | –õ–∏–Ω–µ–π–Ω–æ |

---

## üöÄ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –§–∞–∑–∞ 1: –°—Ä–æ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –¥–Ω—è)
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `destroy()` –º–µ—Ç–æ–¥ –≤ Game.js
2. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ `setInterval` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä—ã
3. ‚úÖ –°–Ω–∏–∑–∏—Ç—å FPS —Å 60 –¥–æ 30
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ MongoDB

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 50 ‚Üí 100 –∏–≥—Ä

### –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 –Ω–µ–¥–µ–ª—è)
1. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
2. ‚úÖ Spatial Hashing –¥–ª—è —Ñ–∏–∑–∏–∫–∏
3. ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π FPS
4. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π rate limiting

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 100 ‚Üí 300 –∏–≥—Ä

### –§–∞–∑–∞ 3: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (2-4 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ Redis –¥–ª—è Socket.IO
2. ‚úÖ Nginx Load Balancer
3. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)
4. ‚úÖ Auto-scaling

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 300 ‚Üí 1000+ –∏–≥—Ä

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: VPS (DigitalOcean, Hetzner)
- **100 –∏–≥—Ä:** $20-40/–º–µ—Å—è—Ü (4 CPU, 8 GB RAM)
- **300 –∏–≥—Ä:** $80-120/–º–µ—Å—è—Ü (8 CPU, 16 GB RAM)
- **1000 –∏–≥—Ä:** $300-500/–º–µ—Å—è—Ü (–∫–ª–∞—Å—Ç–µ—Ä –∏–∑ 3-5 —Å–µ—Ä–≤–µ—Ä–æ–≤)

### –í–∞—Ä–∏–∞–Ω—Ç 2: AWS/GCP (—Å auto-scaling)
- **100 –∏–≥—Ä:** $50-100/–º–µ—Å—è—Ü
- **300 –∏–≥—Ä:** $150-300/–º–µ—Å—è—Ü
- **1000 –∏–≥—Ä:** $500-1000/–º–µ—Å—è—Ü

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –§–∞–∑—ã 1** - –±—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–¥—É—Ç 2x –ø—Ä–∏—Ä–æ—Å—Ç
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ–Ω** - –¥–æ–±–∞–≤—å—Ç–µ `/metrics` endpoint
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Artillery –∏–ª–∏ k6
4. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–µ –ø–µ—Ä–µ–ø–ª–∞—á–∏–≤–∞–π—Ç–µ –∑–∞—Ä–∞–Ω–µ–µ

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –ø–æ–º–æ–≥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞–∫—É—é-—Ç–æ –∏–∑ —ç—Ç–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π?

