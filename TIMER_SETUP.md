# Настройка таймера хода в мультиплеере

## ✅ Серверное управление таймером

**ВАЖНО:** Таймер полностью управляется сервером для честной игры!

- ✅ **Сервер** отслеживает время и автоматически меняет ход
- ✅ **Клиент** только отображает таймер, получая обновления от сервера
- ✅ Защита от читов - клиент не может манипулировать таймером
- ✅ Синхронизация между всеми игроками

## Основные компоненты

### 1. Настройки (settings.js)
```javascript
var TURN_TIMER_ENABLED = true;
var TURN_TIMER_DURATION = 30; // секунды на ход
var TURN_TIMER_WARNING = 10;  // предупреждение за 10 секунд
```

### 2. Интерфейс игрока (CPlayerGUI.js)
- Добавлен визуальный таймер рядом с именем игрока
- Цвет меняется на красный за 10 секунд до окончания
- Автоматически скрывается когда не активен

### 3. Логика игры (CGame.js)
- Автоматический запуск/остановка таймера при смене хода
- Обработка таймаута хода
- Синхронизация с сервером

### 4. Серверная логика (Game.js)
- Серверный таймер с принудительной сменой хода
- События для синхронизации между клиентами
- Защита от читерства

### 5. Сетевая синхронизация (CNTable.js)
- Обработка событий таймера от сервера
- Синхронизация состояния между клиентами

## Как использовать

### Включить/выключить таймер
В `settings.js` измените:
```javascript
var TURN_TIMER_ENABLED = true;  // false для отключения
```

### Изменить время на ход
В `settings.js` измените:
```javascript
var TURN_TIMER_DURATION = 60; // 60 секунд на ход
```

### Изменить время предупреждения
В `settings.js` измените:
```javascript
var TURN_TIMER_WARNING = 15; // предупреждение за 15 секунд
```

## События таймера

### Клиент → Сервер
- `timer-update` - обновление времени
- `turn-timeout` - время истекло

### Сервер → Клиент
- `timer-start` - запуск таймера
- `timer-update` - обновление времени
- `timer-stop` - остановка таймера
- `timer-timeout` - время истекло
- `timer-sync` - синхронизация между клиентами

## Особенности реализации

1. **Двойная защита**: Таймер работает и на клиенте, и на сервере
2. **Синхронизация**: Все клиенты видят одинаковое время
3. **Принудительная смена**: Сервер принудительно меняет ход при таймауте
4. **Визуальные эффекты**: Предупреждение красным цветом, сообщение "TIME'S UP!"
5. **Только для мультиплеера**: Таймер активен только в режиме GAME_MODE_TWO

## Тестирование

### Быстрый тест таймера
1. Запустите любую игру (одиночную или мультиплеер)
2. Откройте консоль браузера (F12)
3. Введите команду: `testTimer()`
4. Должен появиться таймер на 5 секунд у текущего игрока
5. Через 5 секунд таймер должен исчезнуть и ход перейти к другому игроку

### Команды для отладки
- `showGameInfo()` - показать информацию о текущем состоянии игры
- `checkSocket()` - проверить и исправить состояние сокета
- `testServerTimer()` - показать инструкции по тестированию серверного таймера

**Устаревшие команды (больше не используются):**
- ~~`testTimer()`~~ - клиентский таймер отключен
- ~~`forceTurnChange()`~~ - только сервер меняет ход
- ~~`forceServerTurnChange()`~~ - сервер делает это автоматически

### Полный тест в мультиплеере
1. Включите таймер в settings.js: `TURN_TIMER_ENABLED = true`
2. Запустите мультиплеерную игру
3. Таймер должен появиться у активного игрока
4. Через 30 секунд ход должен автоматически перейти к другому игроку
5. За 10 секунд до окончания таймер должен стать красным

### Отладка
Если возникают ошибки:
1. Проверьте консоль браузера на ошибки JavaScript
2. Убедитесь, что все файлы загружены корректно
3. Проверьте, что константы TURN_TIMER_* определены в settings.js

## Возможные улучшения

1. Добавить звуковые уведомления
2. Добавить анимацию таймера
3. Разные настройки времени для разных режимов игры
4. Пауза таймера при отключении игрока
5. Настройка времени в интерфейсе создания комнаты
