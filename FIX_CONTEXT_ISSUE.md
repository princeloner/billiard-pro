# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º this

## –ü—Ä–æ–±–ª–µ–º–∞

–¢–∞–π–º–µ—Ä —Ä–∞–±–æ—Ç–∞–ª, —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å, –Ω–æ **—Ö–æ–¥ –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –ü—Ä–∏—á–∏–Ω–∞

–í `controllers/Game.js` –≤ –º–µ—Ç–æ–¥–µ `startTurnTimer()`:

```javascript
setTimeout(() => {
  this.changeTurn(false);  // ‚ùå this —Ç–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç!
}, 1000);
```

–ö–æ–≥–¥–∞ `setTimeout` –≤—ã–∑—ã–≤–∞–µ—Ç callback, –∫–æ–Ω—Ç–µ–∫—Å—Ç `this` —Ç–µ—Ä—è–µ—Ç—Å—è, –∏ `this.changeTurn` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `undefined`.

## –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `self`

```javascript
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ this
var self = this;

_turnTimer = setInterval(() => {
  // ...
  if (_turnTimeLeft <= 0) {
    self.stopTurnTimer();  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º self –≤–º–µ—Å—Ç–æ this
    
    setTimeout(() => {
      self.changeTurn(false);  // ‚úÖ –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç!
    }, 1000);
  }
}, 1000);
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è roomid

–ë—ã–ª–æ:
```javascript
io.to(roomid).emit("changeTurn", bFault);  // ‚ùå roomid –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –º–æ–¥—É–ª—è
```

–°—Ç–∞–ª–æ:
```javascript
io.to(_roomid).emit("changeTurn", bFault);  // ‚úÖ _roomid –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ:

```
‚è∞ Time's up for player2!
üîÑ Calling changeTurn for timeout...
üîÑ Executing changeTurn now!
üîÑ Server changeTurn called, fault: false
   Current player before: player2
   Room ID: q4od9EKcitueQ0cmAAAF
üë• Turn changed from player2 to player1
üì§ Emitting changeTurn event to room: q4od9EKcitueQ0cmAAAF
‚úÖ changeTurn event emitted
‚è±Ô∏è Starting turn timer for player1: 30s
```

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `controllers/Game.js`:
  - –°—Ç—Ä–æ–∫–∞ 460: –î–æ–±–∞–≤–ª–µ–Ω–æ `var self = this;`
  - –°—Ç—Ä–æ–∫–∞ 476: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `self.stopTurnTimer()`
  - –°—Ç—Ä–æ–∫–∞ 487: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `self.changeTurn(false)`
  - –°—Ç—Ä–æ–∫–∞ 129: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `_roomid` –≤–º–µ—Å—Ç–æ `roomid`
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
2. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–µ –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞
3. –°–æ–∑–¥–∞–π—Ç–µ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω—É—é –∏–≥—Ä—É
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥ (–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è)
5. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞:
   - `‚è∞ Time's up for playerX!`
   - `üîÑ Calling changeTurn for timeout...`
   - `üîÑ Executing changeTurn now!`
   - `üë• Turn changed from playerX to playerY`
6. –í –±—Ä–∞—É–∑–µ—Ä–µ –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–º–µ–Ω–∏—Ç—å—Å—è —Ö–æ–¥

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

‚úÖ –¢–∞–π–º–µ—Ä –æ—Ç—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è
‚úÖ –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "TIME'S UP!"
‚úÖ **–•–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –¥—Ä—É–≥–æ–º—É –∏–≥—Ä–æ–∫—É**
‚úÖ –¢–∞–π–º–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
‚úÖ –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è

## –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –ª–æ–≥–∏ –≤—ã—à–µ
2. –ï—Å–ª–∏ –Ω–µ—Ç –ª–æ–≥–æ–≤ `üîÑ Executing changeTurn now!` - –ø—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–≥–∏, –Ω–æ —Ö–æ–¥ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è - –ø—Ä–æ–±–ª–µ–º–∞ —Å Socket.IO —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `checkSocket()` –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

